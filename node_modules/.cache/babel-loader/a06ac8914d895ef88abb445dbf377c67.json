{"ast":null,"code":"import _objectSpread from \"/home/davi/Desktop/gerenciamento-estagio-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/home/davi/Desktop/gerenciamento-estagio-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/davi/Desktop/gerenciamento-estagio-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport decode from 'jwt-decode';\nimport { Properties } from '../config';\n\nvar AuthService =\n/*#__PURE__*/\nfunction () {\n  /*----------------------------------------------------------------------------------------------------*/\n  function AuthService(domain) {\n    _classCallCheck(this, AuthService);\n\n    this.domain = domain || Properties.domain;\n    this.fetch = this.fetch.bind(this);\n    this.login = this.login.bind(this);\n    this.user = null;\n  }\n  /*----------------------------------------------------------------------------------------------------*/\n\n\n  _createClass(AuthService, [{\n    key: \"login\",\n    value: function login(username, password) {\n      var _this = this;\n\n      return this.fetch(\"\".concat(this.domain, \"/auth\"), {\n        method: 'POST',\n        body: JSON.stringify({\n          username: username,\n          password: password\n        })\n      }).then(function (res) {\n        if (!res.error) {\n          _this.setToken(res.access_token);\n\n          _this.setRefreshToken(res.refresh_token);\n\n          _this.setUser({\n            role: res.user_role\n          });\n\n          _this.updateProfile(res.access_token);\n        }\n\n        return Promise.resolve(res);\n      });\n    }\n    /*----------------------------------------------------------------------------------------------------*/\n\n  }, {\n    key: \"loggedIn\",\n    value: function loggedIn() {\n      var token = this.getToken();\n\n      if (!!!token) {\n        return false;\n      }\n\n      if (this.isTokenExpired(token)) {\n        var rfToken = this.getRefreshToken();\n\n        if (this.isTokenExpired(rfToken)) {\n          return false;\n        }\n\n        this.refreshToken(rfToken);\n      }\n\n      return true;\n    }\n    /*----------------------------------------------------------------------------------------------------*/\n\n  }, {\n    key: \"refreshToken\",\n    value: function refreshToken(refreshTokenId) {\n      var _this2 = this;\n\n      return fetch(\"\".concat(this.domain, \"/refresh\"), {\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': 'Bearer ' + this.getRefreshToken()\n        },\n        method: 'POST'\n      }).then(function (res) {\n        res.json().then(function (json) {\n          _this2.setToken(json.access_token);\n\n          console.log(\"token refreshed\");\n        });\n      });\n    }\n    /*----------------------------------------------------------------------------------------------------*/\n\n  }, {\n    key: \"isTokenExpired\",\n    value: function isTokenExpired(token) {\n      try {\n        var decoded = decode(token);\n\n        if (decoded.exp < Date.now() / 1000) {\n          return true;\n        }\n\n        return false;\n      } catch (err) {\n        return false;\n      }\n    }\n    /*----------------------------------------------------------------------------------------------------*/\n\n  }, {\n    key: \"setToken\",\n    value: function setToken(idToken) {\n      localStorage.setItem('id_token', idToken);\n    }\n    /*----------------------------------------------------------------------------------------------------*/\n\n  }, {\n    key: \"getToken\",\n    value: function getToken() {\n      return localStorage.getItem('id_token');\n    }\n    /*----------------------------------------------------------------------------------------------------*/\n\n  }, {\n    key: \"setRefreshToken\",\n    value: function setRefreshToken(idToken) {\n      localStorage.setItem('id_refresh_token', idToken);\n    }\n    /*----------------------------------------------------------------------------------------------------*/\n\n  }, {\n    key: \"getRefreshToken\",\n    value: function getRefreshToken() {\n      return localStorage.getItem('id_refresh_token');\n    }\n    /*----------------------------------------------------------------------------------------------------*/\n\n  }, {\n    key: \"logout\",\n    value: function logout() {\n      localStorage.removeItem('id_token');\n      localStorage.removeItem('id_refresh_token');\n      localStorage.removeItem('user_profile_role');\n      localStorage.removeItem('user_profile_email');\n      localStorage.removeItem('user_profile_username');\n      window.location.replace(\"/\");\n    }\n    /*----------------------------------------------------------------------------------------------------*/\n\n  }, {\n    key: \"updateProfile\",\n    value: function updateProfile(token) {\n      fetch(\"\".concat(this.domain, \"/me\"), {\n        method: 'GET',\n        headers: {\n          Authorization: 'Bearer ' + token\n        }\n      }).then(function (res) {\n        res.json().then(function (json) {\n          localStorage.setItem('user_profile_role', json.role_id);\n          localStorage.setItem('user_profile_email', json.email);\n          localStorage.setItem('user_profile_username', json.username);\n        });\n      });\n    }\n    /*----------------------------------------------------------------------------------------------------*/\n\n  }, {\n    key: \"setUser\",\n    value: function setUser(data) {\n      this.user = data;\n    }\n    /*----------------------------------------------------------------------------------------------------*/\n\n  }, {\n    key: \"getUser\",\n    value: function getUser() {\n      return this.user;\n    }\n    /*----------------------------------------------------------------------------------------------------*/\n\n  }, {\n    key: \"getUserRole\",\n    value: function getUserRole() {\n      if (this.getUser() == null) {\n        return localStorage.getItem('user_profile_role');\n      } else {\n        return this.getUser().role;\n      }\n    }\n    /*----------------------------------------------------------------------------------------------------*/\n\n  }, {\n    key: \"getAuthorizationHeader\",\n    value: function getAuthorizationHeader() {\n      return 'Bearer ' + this.getToken();\n    }\n    /*----------------------------------------------------------------------------------------------------*/\n\n  }, {\n    key: \"fetch\",\n    value: function (_fetch) {\n      function fetch(_x, _x2) {\n        return _fetch.apply(this, arguments);\n      }\n\n      fetch.toString = function () {\n        return _fetch.toString();\n      };\n\n      return fetch;\n    }(function (url, options) {\n      var headers = {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n      };\n\n      if (this.loggedIn()) {\n        headers['Authorization'] = this.getAuthorizationHeader();\n      }\n\n      return fetch(url, _objectSpread({\n        headers: headers\n      }, options)).then(this._checkStatus).then(function (response) {\n        return response.json();\n      });\n    })\n    /*----------------------------------------------------------------------------------------------------*/\n\n  }, {\n    key: \"_checkStatus\",\n    value: function _checkStatus(response) {\n      if (response.status >= 200 && response.status < 300) {\n        return response;\n      } else {\n        var error = new Error(response.statusText);\n        error.response = response;\n        throw error;\n      }\n    }\n    /*----------------------------------------------------------------------------------------------------*/\n\n  }]);\n\n  return AuthService;\n}();\n\nexport default AuthService;","map":{"version":3,"sources":["/home/davi/Desktop/gerenciamento-estagio-frontend/src/services/AuthService.js"],"names":["decode","Properties","AuthService","domain","fetch","bind","login","user","username","password","method","body","JSON","stringify","then","res","error","setToken","access_token","setRefreshToken","refresh_token","setUser","role","user_role","updateProfile","Promise","resolve","token","getToken","isTokenExpired","rfToken","getRefreshToken","refreshToken","refreshTokenId","headers","json","console","log","decoded","exp","Date","now","err","idToken","localStorage","setItem","getItem","removeItem","window","location","replace","Authorization","role_id","email","data","getUser","url","options","loggedIn","getAuthorizationHeader","_checkStatus","response","status","Error","statusText"],"mappings":"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","sourcesContent":["import decode from 'jwt-decode';\nimport { Properties } from '../config';\n\nclass AuthService \n{\n\n/*----------------------------------------------------------------------------------------------------*/\n\n\tconstructor(domain)\n\t{\n\t\tthis.domain\t\t\t= domain || Properties.domain;\n\t\tthis.fetch\t\t\t= this.fetch.bind(this);\n\t\tthis.login\t\t\t= this.login.bind(this);\n\t\tthis.user  \t\t\t= null;\n\t}\n\n/*----------------------------------------------------------------------------------------------------*/\n\n\tlogin(username, password) \n\t{\n\t\treturn this.fetch(`${this.domain}/auth`,\n\t\t\t{\n\t\t\t\tmethod: 'POST',\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\tusername: username, \n\t\t\t\t\tpassword: password\n\t\t\t\t})\n\t\t\t}\n\t\t).then(res =>\n\t\t{\n\t\t\tif (!res.error) \n\t\t\t{\n\t\t\t\tthis.setToken(res.access_token);\n\t\t\t\tthis.setRefreshToken(res.refresh_token);\n\t\t\t\tthis.setUser({role: res.user_role});\n\t\t\t\tthis.updateProfile(res.access_token);\n\t\t\t}\n\t\t\t\n\t\t\treturn Promise.resolve(res);\n\t\t});\n\t}\n\n/*----------------------------------------------------------------------------------------------------*/\n\n\tloggedIn() \n\t{\n\t\tconst token = this.getToken();\n\t\t\n\t\tif (!!!token) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.isTokenExpired(token)) \n\t\t{\n\t\t\tconst rfToken = this.getRefreshToken();\n\n\t\t\tif(this.isTokenExpired(rfToken)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.refreshToken(rfToken);\n\t\t}\n\t\t\n\t\treturn true;\n\t}\n\n/*----------------------------------------------------------------------------------------------------*/\n\n\trefreshToken(refreshTokenId) \n\t{\n\t\treturn fetch(`${this.domain}/refresh`,\n\t\t\t{\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t'Authorization': 'Bearer ' + this.getRefreshToken()\n\t\t\t\t},\t\n\t\t\t\tmethod: 'POST'\n\t\t\t}\n\t\t).then(res => \n\t\t{\n\t\t\tres.json().then(json => \n\t\t\t{\n\t\t\t\tthis.setToken(json.access_token);\n\t\t\t\tconsole.log(\"token refreshed\");\t\n\t\t\t})\n\t\t});\n\t}\n\n/*----------------------------------------------------------------------------------------------------*/\n\n\tisTokenExpired(token) \n\t{\n\t\ttry\n\t\t{\n\t\t\tconst decoded = decode(token);\n\n\t\t\tif (decoded.exp < Date.now() / 1000) {\n\t\t\t\treturn true;\n\t\t\t} \n\t\t\t\n\t\t\treturn false;\n\n\t\t} catch(err) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n/*----------------------------------------------------------------------------------------------------*/\n\n\tsetToken(idToken) {\n\t\tlocalStorage.setItem('id_token', idToken);\n\t}\n\n/*----------------------------------------------------------------------------------------------------*/\n\n\tgetToken() {\n\t\treturn localStorage.getItem('id_token');\n\t}\n\n/*----------------------------------------------------------------------------------------------------*/\n\n\tsetRefreshToken(idToken) {\n\t\tlocalStorage.setItem('id_refresh_token', idToken);\n\t}\n\n/*----------------------------------------------------------------------------------------------------*/\n\n\tgetRefreshToken() {\n\t\treturn localStorage.getItem('id_refresh_token');\n\t}\n\n/*----------------------------------------------------------------------------------------------------*/\n\n\tlogout() {\n\t\tlocalStorage.removeItem('id_token');\n\t\tlocalStorage.removeItem('id_refresh_token');\n\t\tlocalStorage.removeItem('user_profile_role');\n\t\tlocalStorage.removeItem('user_profile_email');\n\t\tlocalStorage.removeItem('user_profile_username');\n\n\t\twindow.location.replace(\"/\");\n\t}\n\n/*----------------------------------------------------------------------------------------------------*/\n\t\n\tupdateProfile(token) {\n\t\tfetch(`${this.domain}/me`,\n\t\t\t{\n\t\t\t\tmethod: 'GET',\n\t\t\t\theaders: {Authorization: 'Bearer ' + token}\n\t\t\t}\n\t\t)\n\t\t\t.then(res => \n\t\t\t{\n\t\t\t\tres.json().then(json => {\n\t\t\t\t\t\tlocalStorage.setItem('user_profile_role', json.role_id);\n\t\t\t\t\t\tlocalStorage.setItem('user_profile_email', json.email);\n\t\t\t\t\t\tlocalStorage.setItem('user_profile_username', json.username);\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t}\n\t\t)\t\n\t}\n\n/*----------------------------------------------------------------------------------------------------*/\n\t\n\tsetUser(data) {\n\t\tthis.user = data;\n\t}\n\n/*----------------------------------------------------------------------------------------------------*/\n\t\n\tgetUser() {\n\t\treturn this.user;\n\t}\n\n/*----------------------------------------------------------------------------------------------------*/\n\n\tgetUserRole() \n\t{\n\t\tif (this.getUser() == null) {\n\t\t\treturn localStorage.getItem('user_profile_role');\n\t\t} \n\t\telse {\n\t\t\treturn this.getUser().role;\n\t\t}\n\t}\n\n/*----------------------------------------------------------------------------------------------------*/\n\n\tgetAuthorizationHeader() {\n\t\treturn 'Bearer ' + this.getToken();\n\t}\n\n/*----------------------------------------------------------------------------------------------------*/\n\n\tfetch(url, options) \n\t{\t\n\t\tconst headers = {\n\t\t\t'Accept': 'application/json',\n\t\t\t'Content-Type': 'application/json'\n\t\t}\n\n\t\tif (this.loggedIn()) {\n\t\t\theaders['Authorization'] = this.getAuthorizationHeader();\n\t\t}\n\n\t\treturn fetch(url, \n\t\t{\n\t\t\theaders,\n\t\t\t...options\n\t\t})\n\t\t\t.then(this._checkStatus)\n\t\t\t.then(response => response.json())\n\t}\n\n/*----------------------------------------------------------------------------------------------------*/\n\n\t_checkStatus(response) {\n\t\tif (response.status >= 200 && response.status < 300) {\n\t\t\treturn response;\n\t\t} \n\t\telse \n\t\t{\n\t\t\tvar error = new Error(response.statusText);\n\t\t\terror.response = response;\n\t\t\tthrow error;\n\t\t}\n\t}\n\n/*----------------------------------------------------------------------------------------------------*/\n\n}\n\nexport default AuthService;"]},"metadata":{},"sourceType":"module"}